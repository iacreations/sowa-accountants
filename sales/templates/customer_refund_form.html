{% load humanize %}

  {% include 'includes/navbar.html' %}
  {% include 'includes/sidebar.html' %}
  <style>
  body { background:#f4f6f8; font-family:"Poppins",sans-serif; padding:30px; width:100%; }

    .container-box { background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.08); padding:20px; margin-left:18%; margin-top:5%; width:83%}
    h2 { color:#39B54B; margin-bottom:18px; }
    .btn-green { background:#39B54B; color:#fff; border:none; border-radius:6px; padding:10px 14px; font-weight:600; }
    .btn-light { background:#f0f0f0; border:none; border-radius:6px; padding:10px 14px; }
    .hint { color:#6c757d; font-size:.9rem; }

  </style>
  <a href="{% url 'sales:customer-refunds-list' %}" class="text-decoration-none">&lt; Back to Customer Credits</a>

  <div class="container container-box" id="container">
    <h2>Refund Customer</h2>

    <div class="mb-3">
      <div><b>Customer:</b> {{ customer.customer_name }}</div>
      <div><b>Available Credit:</b> {{ max_refundable|floatformat:2|intcomma }}</div>
      <div class="hint">Refund amount must be less than or equal to the available credit.</div>
    </div>

    {% if form_error %}
      <div class="alert alert-danger">{{ form_error }}</div>
    {% endif %}

    <form method="post">
      {% csrf_token %}

      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Refund Date</label>
          <input type="date" name="refund_date" class="form-control" value="{{ today|default:'' }}">
        </div>

        <div class="col-md-4">
          <label class="form-label">Paid From (Bank/Cash)</label>
          <select class="form-control" name="paid_from" required>
            <option value="">Select Account</option>
            {% for acc in accounts %}
              <option value="{{ acc.id }}">
                {{ acc.account_name }}{% if acc.account_number %} ({{ acc.account_number }}){% endif %}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label">Amount</label>
          <input type="number" step="0.01" name="amount" class="form-control" required placeholder="0.00">
        </div>

        <div class="col-md-6">
          <label class="form-label">Reference No</label>
          <input type="text" name="reference_no" class="form-control" placeholder="Optional">
        </div>

        <div class="col-md-6">
          <label class="form-label">Memo</label>
          <input type="text" name="memo" class="form-control" placeholder="Optional">
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button class="btn btn-green" type="submit">Save Refund</button>
        <a href="{% url 'sales:customer-refunds-list' %}" class="btn btn-light">Cancel</a>
      </div>
    </form>
  </div>
  {% include 'includes/footer.html' %}
