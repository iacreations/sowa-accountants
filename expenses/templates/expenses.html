{% load static %}
{% load humanize %}
{% include 'includes/navbar.html' %}
<style>
  /* new */
  .num{text-align:right}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px;color:#fff}
  .pill-brown{ color: #185a2e;}
  .pill-orange{ color: #185a2e;}
  .pill-blue{ color: #185a2e;}
  .status-chip{display:inline-block;color: #185a2e;padding:3px 8px;border-radius:999px;font-weight:700;font-size:12px}

  .action-cell{white-space:nowrap}
  .row-actions{display:inline-flex;align-items:center;gap:10px}
  .edit-link{color:#39B54B;font-weight:800;text-decoration:none}
  .menu-wrap{position:relative;display:inline-block}
  /* .kebab{background:#f0fdf4;border:1px solid #cceedd;border-radius:8px;padding:4px 8px;cursor:pointer} */
  .flyout{display:none;position:absolute;right:0;top:110%;background:#fff;border:1px solid #e6e6e6;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.08);min-width:150px;overflow:hidden;z-index:5}
  .menu-wrap:focus-within .flyout,.menu-wrap:hover .flyout{display:block}
  .flyout a{display:block;padding:8px 12px;text-decoration:none;color:#111}
  .flyout a:hover{background:#f6fef8}

/* stack the banners in a single column */
.banner-grid{
  display: flex;
  flex-direction: column;
  gap: 10px;
  background:#fff3e0;
}
/* optional: make them a little tighter on mobile/desktop alike */
  .mini-banner{
    display:flex; flex-direction:column; gap:2px;
    padding:10px 12px; border-radius:12px; text-decoration:none;
    color:#fff; border:1px solid rgba(255,255,255,.25);
    box-shadow:0 8px 18px rgba(0,0,0,.12);
    width: 100%;
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .mini-banner:hover{ transform:translateY(-2px); box-shadow:0 12px 24px rgba(0,0,0,.16); }
  .mini-banner .kicker{ font-size:12px; font-weight:800; letter-spacing:.3px; opacity:.95; text-transform:uppercase; }
  .mini-banner .value{ font-weight:900; font-size:16px; line-height:1.15; }
  .mini-banner .sub{ font-size:12px; opacity:.95; }

  /* colors */
  .mini-banner.brown  { background:#fff3e0; border:1px solid #ffe0b2; color:#a75a00;}
  .mini-banner.orange { background:linear-gradient(180deg,#fcb842 0%,#eca95b 100%); }
  .mini-banner.blue   { background:linear-gradient(180deg,#6594fc 0%,#5f86f1 100%); }
/* styling the dropdown of the edit */
.num{ text-align:right; }
  .action-cell{ white-space:nowrap; }
  .row-actions{ display:flex; align-items:center; gap:10px; }
  .row-actions a{ color:#39B54B; text-decoration:none; font-weight:800; }
  .menu-wrap{ position:relative; display:inline-block; }
  .kebab{ background:#f0fdf4; border:1px solid #cceedd; border-radius:8px; padding:4px 8px; cursor:pointer; }
  .flyout{ display:none; position:absolute; right:0; top:110%; background:#fff; border:1px solid #e6e6e6; border-radius:8px; box-shadow:0 8px 22px rgba(0,0,0,.08); min-width:180px; overflow:hidden; z-index:5; }
  .flyout a{ display:block; padding:8px 12px; text-decoration:none; color:#111; }
  .flyout a:hover{ background:#f6fef8; }
  .menu-wrap:focus-within .flyout, .menu-wrap:hover .flyout{ display:block; }
  /* responsive */
  @media (max-width: 900px){ .banner-grid{ grid-template-columns:1fr; } }
/* Laptops & small desktops */
@media only screen and (min-width: 1024px) and (max-width: 1600px) {
#body{
  margin-top: 17%;
}

}
  /* Activities navbar (scoped) */
  .sa-wrap{padding:8px 0}
  .sa-nav{
    background:#39B54B; color:#fff; border-radius:14px;
    padding:10px; box-shadow:0 8px 22px rgba(0,0,0,.08);
    display:flex; align-items:center; gap:8px; flex-wrap:wrap;
  }
  .sa-item{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:999px; font-weight:700;
    text-decoration:none; color:#0b3518; background:#e8fbef;
    border:1px solid #c8f0d6; transition:transform .15s ease, box-shadow .15s ease, background .15s ease;
  }
  .sa-item:hover{ transform:translateY(-1px); box-shadow:0 10px 18px rgba(0,0,0,.10); background:#f5fff8; }
  .sa-item i{ font-size:18px }
  .sa-item.active{ background:#fff; border-color:#fff; color:#13873a }

  .sa-spacer{ flex:1 1 auto }
  .sa-new{
    position:relative;
  }
  .sa-new-btn{
    background:#0c8f3a; color:#fff; border:1px solid #0a7a32;
    border-radius:10px; padding:10px 14px; font-weight:800; display:inline-flex; gap:8px; align-items:center;
  }
  .sa-menu{
    display:none; position:absolute; right:0; top:110%;
    background:#fff; color:#111; border:1px solid #e6e6e6; border-radius:12px;
    box-shadow:0 14px 28px rgba(0,0,0,.12); min-width:210px; overflow:hidden; z-index:20;
  }
  .sa-menu a{ display:block; padding:10px 12px; text-decoration:none; color:#111; }
  .sa-menu a:hover{ background:#f6fef8 }
  .sa-new.open .sa-menu{ display:block }

  .sa-rail{
    display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;
  }
  .sa-chip{
    background:#fff; border:1px solid #e8ecef; color:#104b2a;
    padding:8px 12px; border-radius:10px; font-weight:700;
  }

  @media (max-width: 900px){
    .sa-nav{ overflow:auto; scrollbar-width:none; }
    .sa-nav::-webkit-scrollbar{ display:none; }
  }
.link-num {
  color: inherit;
  text-decoration: none;
}

.link-num:hover {
  text-decoration: underline;
}
</style>
{% include 'includes/sidebar.html' %}

<div class="action" id="action">
  <h1 style="color: #39B54B; font-weight: 600;">EXPENSES</h1>
  <div class="search_bar" id="search" style="width: 25%;">
    <input type="text" placeholder="Search expenses" />
  </div>

  <!-- New Transactions dropdown – EXPENSES -->
  <div class="dropdown-wrapper">
    <button class="button">
      <span class="button_text">New Transactions</span>
      <span class="button_icon"><i class='bx bx-chevron-down'></i></span>
    </button>
    <div class="dropdown-content">
      <a href="{% url 'expenses:add-bill' %}">Create a Bill</a>
      <a href="{% url 'expenses:add-expenses' %}">Make an Expense</a>
      <a href="{% url 'expenses:add-cheque' %}">Create a Cheque</a>
      <a href="{% url 'expenses:purchase_order' %}">Make Purchase order</a>
      <a href="{% url 'expenses:supplier-credit' %}">Create a Supplier credit</a>
      <a href="{% url 'expenses:pay-down-credit' %}">Create a Pay down credit</a>
      <a href="{% url 'expenses:credit-card' %}">Create a Credit card credit</a>
      <a href="{% url 'expenses:import-bills' %}">Import bills</a>
    </div>
  </div>

  <!-- Optional: new supplier button -->
  <a href="{% url 'sowaf:add-supplier' %}" style="text-decoration: none;">
    <button class="button" style="width: fit-content;">
      <span class="button_text">New Supplier</span>
      <span class="button_icon">
        <i class='bx bx-folder-plus'></i>
      </span>
    </button>
  </a>

  <button class="button">
    <span class="button_text">CUSTOMIZE</span>
    <span class="button_icon">
      <i class='bx bxs-customize'></i>
    </span>
  </button> 
</div>

<div class="main_body" id="body" style="margin-top: 14%;">
  <div class="tabs" id="tab">

    <!-- TAB 1: EXPENSE ACTIVITIES (first + default) -->
    <input type="radio" class="tabs_radio" name="tabs-example" id="tab1" checked>
    <label for="tab1" class="tabs_label">Expense Activities</label>
    <div class="tab-content" id="expense-activities">
      <div class="sa-wrap">
        <nav class="sa-nav">
          <a class="sa-item" href="{% url 'sowaf:suppliers' %}">
            <i class='bx bxs-truck' ></i> View Suppliers
          </a>

          <a class="sa-item" href="{% url 'expenses:add-bill' %}">
            <i class='bx bx-file'></i>Create a Bill
          </a>

          <a class="sa-item" href="{% url 'expenses:add-expenses' %}">
            <i class='bx bx-receipt'></i>Record an Expense
          </a>

          <a class="sa-item" href="{% url 'expenses:add-cheque' %}">
            <i class='bx bx-money-withdraw'></i> Create a Cheque
          </a>

          <a class="sa-item" href="{% url 'expenses:purchase_order' %}">
            <i class='bx bx-basket'></i>Create a Purchase order
          </a>

          <a class="sa-item" href="{% url 'expenses:supplier-credit' %}">
            <i class='bx bx-credit-card-front'></i>Create a Supplier credit
          </a>

          <a class="sa-item" href="{% url 'expenses:pay-down-credit' %}">
            <i class='bx bx-down-arrow-circle'></i>Create a Pay down credit
          </a>

          <a class="sa-item" href="{% url 'expenses:credit-card' %}">
            <i class='bx bx-card'></i>Create a Credit card credit
          </a>
        </nav>

        <div class="sa-rail">
          <span class="sa-chip">Quick expense links</span>
          <span class="sa-chip">Bills • Expenses • Cheques • POs • Credits</span>
        </div>
      </div>
    </div>

    <!-- TAB 2: EXPENSES OVERVIEW (table) -->
    <input type="radio" class="tabs_radio" name="tabs-example" id="tab2">
    <label for="tab2" class="tabs_label">Expenses Overview</label>
    <div class="tab-content" id="expenses-overview">

      <section>
        <h3 style="color: rgb(7, 142, 36);">ALL EXPENSES</h3>
        <table class="content-table">
          <thead>
            <tr>
              <th>DATE</th>
              <th>TYPE</th>
              <th>TRANSACTION NO.</th>
              <th>PAYEE</th>
              <th>CATEGORY</th>
              <th>TOTAL BEFORE TAX</th>
              <th>SALES TAX</th>
              <th>TOTAL</th>
              <th>ACTIONS <i class='bx bxs-down-arrow'></i></th>
            </tr>
          </thead>
          <tbody>
            {% for r in transactions %}
            <tr>
              <td>{{ r.date|date:"d/m/Y" }}</td>
              <td>
                {% if r.kind == "Expense" %}
                  <span class="pill pill-brown">Expense</span>
                {% elif r.kind == "Bill" %}
                  <span class="pill pill-blue">Bill</span>
                {% elif r.kind == "Cheque" %}
                  <span class="pill pill-orange">Cheque</span>
                {% elif r.kind == "Purchase Order" %}
                  <span class="pill pill-brown">Purchase Order</span>
                {% elif r.kind == "Supplier Credit" %}
                  <span class="pill pill-blue">Supplier Credit</span>
                {% elif r.kind == "Credit Card Payment" %}
                  <span class="pill pill-orange">Card Payment</span>
                {% elif r.kind == "Credit Card Credit" %}
                  <span class="pill pill-blue">Card Credit</span>
                {% else %}
                  <span class="pill pill-brown">{{ r.kind }}</span>
                {% endif %}
              </td>
              <td>{{ r.number }}</td>
              <td>{{ r.payee }}</td>
              <td>{{ r.category }}</td>
              <td class="num">{{ r.total_before_tax|floatformat:2|intcomma }}</td>
              <td class="num">{{ r.sales_tax|floatformat:2|intcomma }}</td>
              <td class="num">{{ r.total|floatformat:2|intcomma }}</td>
              <td class="action-cell">
                <a class="edit-link" href="{{ r.edit_url }}">Edit</a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="9">No expenses yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </div>

    <!-- If you ever want a 3rd tab (eg Suppliers), you can add it here -->
  </div>
</div>

<script>
  document.addEventListener('click', (e)=>{
    document.querySelectorAll('.menu-wrap').forEach(w=>{
      if(!w.contains(e.target)) w.classList.remove('open');
    });
  });
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Escape'){
      document.querySelectorAll('.menu-wrap').forEach(w=>w.classList.remove('open'));
    }
  });
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.kebab');
    if(btn){
      const wrap = btn.closest('.menu-wrap');
      wrap.classList.toggle('open');
      e.stopPropagation();
    }
  });
</script>

{% include 'includes/footer.html' %}
