{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart of Accounts Form</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="{% static 'sowaf/images/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'sowaf/styles/style.css' %}" />
  <link rel="stylesheet" href="{% static 'sowaf/styles/bootsrap.min.css' %}" />
  <style>
    * {
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }
    body {
      background: #f4f6f8;
      padding: 30px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2.title {
      text-align: center;
      color: #39B54B;
      margin-bottom: 25px;
    }
    .section-wrapper {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: 500;
      margin-bottom: 5px;
    }
    input, select, textarea {
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      border-top: 1px solid #e0e0e0;
      padding-top: 20px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .btn-cancel { background: #f5f5f5; }
    .btn-green { background: #39B54B; color: #fff; }
    .btn-light-green {
      background: #d2f4dc;
      color: #2a8b3f;
    }
    .dropdown {
      position: relative;
      display: inline-block;
    }
    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .dropdown:hover .dropdown-menu {
      display: block;
    }
    .dropdown-menu button {
      width: 100%;
      padding: 10px 16px;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
    }
    input{
      border: solid 1px green;
    }
    select{
      border: solid 1px green;
    }
    #account{
      border: solid 1px green;
    }
    textarea{
      border: solid 1px green;
    }
  </style>
</head>
<a href="{% url 'accounts:accounts' %}" class="text-decoration-none " id="btn" style="color: #39B54B;font-size: 23px;">Back to Chart of accouts</a>
  <div class="container">
 <form method='post' action="{% url 'accounts:add-account' %}" enctype= 'multipart/form-data'>
    {% csrf_token %}
    <h2 class="title">Chart of Accounts</h2>

    <div class="section-wrapper">
      <div class="form-grid">
        <div class="form-group">
          <label>Account Name *</label>
          <input type="text" name="account_name" id="account" required />
        </div>
        <div class="form-group">
          <label>Account Number</label>
          <input type="text" name="account_number" id="account" />
        </div>
        <div class="form-group">
  <label>Account Type *</label>
  <select name="account_type" id="account_type" required>
    <option value="">Select account type</option>
    <option>Current Assets</option>    
    <option>Non-Current Assets</option>
    <option>Current Liabilities</option>
    <option>Non-current Liabilities</option>
    <option>Owner's Equity</option>
    <option>Operating Income</option>
    <option>Operating Expense</option>
    <option>Investing Income</option>
    <option>Investing Expense</option>
    <option>Financing Income</option>
    <option>Income taxes</option>
  </select>
</div>
      <!-- detail type  -->
  <div class="form-group">
  <label>Detail Type *</label>
  <select name="detail_type" id="detail_type" required>
    <option value=""></option>
  </select>
</div>
<div class="form-group">
  <label>Tax Category</label>
  <select name="tax_category">
    <option value="">None</option>
    <option value="Capital deductions">Capital deductions</option>
    <option value="Allowable deduction">Allowable deduction</option>
    <option value="Non Allowable deduction">Non Allowable deduction</option>
  </select>
</div>

  <div class="form-group my-5">
  <label for="subAccountCheckbox">Make this a sub-account.
    <input type="checkbox" id="subAccountCheckbox" name="is_subaccount" onchange="toggleSellFields()">
  </label>
  </div>
       <div id="parent_account_field" style="display: none;">
        <label for="parent">Parent Account</label> <div></div>
        <select name="parent" id="parent">
            <option value="">choose parent account</option>
            {% for parent in parents %}
                <option value="{{ parent.id }}">{{ parent.account_name }}</option>
            {% endfor %}
        </select>
    </div>

      <div class="form-grid my-5">
        <div class="form-group">
          <label>Opening Balance</label>
          <input type="number" name="opening_balance" />
        </div>
      </div>
        <div class="form-group">
          <label>As of</label>
          <input type="date" name="as_of"/>
        </div>
    </div>

    <!-- More Info Section -->
    <div class="section-wrapper">
      <h3 style="margin-bottom: 15px; color: #39B54B;">More Info on Opening Balances</h3>
      <div class="form-group">
        <label>Description</label>
        <textarea name="description" rows="3"></textarea>
      </div>
    </div>

    <!-- Footer Buttons -->
    <div class="footer">
      <a href="{% url 'accounts:accounts' %}" class="text-decoration-none button btn-sm" id="btn">Cancel</a>
  
      <div class="dropdown">
          <button type="button" class="btn button btn-green">Save ▼</button>
          <div class="dropdown-menu">
            <button type="submit" name="save_action" style="font-size: 1em;" value="save">Save</button>
            <button type="submit" name="save_action" style="font-size: 1em;" value="save&new">Save & New</button>
            <button type="submit" name="save_action" style="font-size: 1em;" value="save&close">Save & Close</button>
          </div>
        </div>
    </div>
    </div>
    </form>
  </div>
  <script src=" {% static 'sowaf/styles/script.js' %} "></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById("subAccountCheckbox");
        const parentField = document.getElementById("parent_account_field");

        checkbox.addEventListener("change", function () {
            if (this.checked) {
                parentField.style.display = "block"; // Show field
            } else {
                parentField.style.display = "none"; // Hide field
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
    const accountTypeDropdown = document.getElementById("account_type");
    const detailTypeDropdown = document.getElementById("detail_type");

    // Mapping of Account Type → Detail Types
    const detailOptions = {

        "Current Assets": [
            "Assets held for sale","Inventory","Prepayments","Accounts Receivables (A/R)","Other receivables","Cash and Cash quivalents","Other current assets"
        ],

        "Non-Current Assets": [
          "Property","Plant","Equipment","Furniture","Motor Vehicle","Investment property","Intangible Assets","Right of Use Assets","Deffered tax Assets","Other Long term Assets"

        ],
      
        "Current Liabilities": [
            "Accounts Payable (A/P)","Other Payables","Provisions","Short term borrowings","Current tax liabilities","Accrued expenses","Other Current liabilities"

        ],

        "Non-current liabilities":[
          "Long term Borrowings","Pension and other employee obligations","Long term Lease Liabilities","Deffered tax liabilities","Other Non Curent Liabilities"

        ],

        "Owner's Equity": [
            "Share Capital","Share premium","Retained earnings","Non controlling interest","Other Equity components"
        ],

        "Operating Income":[
         "Revenue", "other operation income",
    ],

   "Operating Expense":[
    "Cost of Goods sold","Cost of Sales","Selling and distribution","Administration expenses","Research and development","other operating expenses"
    ],

   "Investing Income":[
    "Share of profits from associates","Rental Income","Dividends","Interest income","Depreciation","Impairment", "Losses","Impairment Reversal","Loss on Disposal of Investments","Other Investing Income"
    ],

   "Investing Expense":[
    "Gain on Disposal of Investments"	,"Fairvalue Gains","Fairvalue Losses","Other Investing Expenses"
],

"Financing Expense":[	
"Interest expense","Other Financing Costs"
],
	
"Income taxes":[
"Income Tax Expense","Other Tax Expenses"
],


    };

    // Function to update Detail Type dropdown
    function updateDetailTypes(accountType) {
        detailTypeDropdown.innerHTML = "<option value=''></option>";

        if (detailOptions[accountType]) {
            detailOptions[accountType].forEach(function (detail) {
                const option = document.createElement("option");
                option.value = detail;
                option.textContent = detail;
                detailTypeDropdown.appendChild(option);
            });
        }
    }

    // Trigger update when Account Type changes
    accountTypeDropdown.addEventListener("change", function () {
        updateDetailTypes(this.value);
    });
    // auto-run on page load if editing
    if (accountTypeDropdown.value) {
        updateDetailTypes(accountTypeDropdown.value);
    }
});

document.addEventListener("DOMContentLoaded", function () {
    const accountTypeDropdown = document.getElementById("account_type");
    const openingBalanceField = document.querySelector("input[name='opening_balance']").closest(".form-group");
    const asOfField = document.querySelector("input[name='as_of']").closest(".form-group");

    // Account types where Opening Balance & As Of should appear
    const allowedTypes = [
        "Accounts Receivable (A/R)",
        "Current Assets",
        "Cash and Cash Equivalents",
        "Fixed Assets",
        "Non-Current Assets",
        "Accounts Payable (A/P)",
        "Credit Card",
        "Current Liabilities",
        "Non-current Liabilities",
        "Owner's Equity"
    ];

    function toggleBalanceFields() {
        const selectedType = accountTypeDropdown.value;

        if (allowedTypes.includes(selectedType)) {
            openingBalanceField.style.display = "block";
            asOfField.style.display = "block";
        } else {
            openingBalanceField.style.display = "none";
            asOfField.style.display = "none";
        }
    }

    // Listen for changes
    accountTypeDropdown.addEventListener("change", toggleBalanceFields);

    // Run on page load in case of edit form
    toggleBalanceFields();
});
</script>
</body>
</html>